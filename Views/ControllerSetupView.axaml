<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:JimmiLauncher.ViewModels"
             x:Class="JimmiLauncher.Views.ControllerSetupView"
             x:DataType="vm:ControllerSetupViewModel">

    <UserControl.Styles>
        <!-- Back button â€” matches OfflineMenuView style -->
        <Style Selector="Button.BackButton">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="Background" Value="Black"/>
            <Setter Property="Foreground" Value="Orange"/>
            <Setter Property="BorderBrush" Value="Orange"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Margin" Value="10"/>
            <Setter Property="MinWidth" Value="120"/>
        </Style>
        <Style Selector="Button.BackButton:pointerover /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Foreground" Value="Chocolate"/>
            <Setter Property="Background" Value="Black"/>
            <Setter Property="BorderBrush" Value="Chocolate"/>
            <Setter Property="BorderThickness" Value="2"/>
        </Style>

        <!-- Action buttons (Save, Apply, Reset, Reload) -->
        <Style Selector="Button.ActionButton">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="Background" Value="Orange"/>
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="MinWidth" Value="100"/>
        </Style>
        <Style Selector="Button.ActionButton:pointerover /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="Chocolate"/>
        </Style>

        <!-- Save button â€” green accent -->
        <Style Selector="Button.SaveButton">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="Background" Value="Green"/>
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="Padding" Value="14,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="MinWidth" Value="140"/>
        </Style>
        <Style Selector="Button.SaveButton:pointerover /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="DarkGreen"/>
        </Style>

        <!-- Clear button â€” small, per-row -->
        <Style Selector="Button.ClearButton">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Background" Value="DarkRed"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="6,2"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Margin" Value="2,0"/>
            <Setter Property="MinWidth" Value="50"/>
        </Style>
        <Style Selector="Button.ClearButton:pointerover /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="Red"/>
        </Style>

        <!-- Section borders -->
        <Style Selector="Border.Section">
            <Setter Property="CornerRadius" Value="5"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Background" Value="Orange"/>
            <Setter Property="BorderBrush" Value="Chocolate"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="Margin" Value="0,6"/>
        </Style>

        <!-- Labels -->
        <Style Selector="TextBlock.SectionTitle">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="Margin" Value="0,0,0,6"/>
        </Style>
        <Style Selector="TextBlock.FieldLabel">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="MinWidth" Value="120"/>
        </Style>
        <Style Selector="TextBlock.BindingLabel">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="MinWidth" Value="130"/>
        </Style>

        <!-- CheckBox -->
        <Style Selector="CheckBox">
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
    </UserControl.Styles>

    <Design.DataContext>
        <vm:ControllerSetupViewModel />
    </Design.DataContext>

    <!-- Main layout: scrollable column -->
    <Grid RowDefinitions="Auto,*,Auto">

        <!-- â•â•â• Top bar â•â•â• -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Left" Margin="10">
            <Button Classes="BackButton"
                    Content="â—€â—€ Back"
                    Command="{Binding NavigateToMainCommand}"/>
        </StackPanel>

        <!-- â•â•â• Scrollable content â•â•â• -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="20,0">
            <StackPanel HorizontalAlignment="Center" MaxWidth="700" Spacing="10">

                <!-- Title -->
                <TextBlock Text="Controller Setup"
                           FontSize="24" FontWeight="Bold"
                           Foreground="Orange" HorizontalAlignment="Center"
                           Margin="0,10,0,4"/>

                <!-- â”€â”€ Port selection â”€â”€ -->
                <Border Classes="Section">
                    <StackPanel Spacing="8">
                        <TextBlock Classes="SectionTitle" Text="Controller Port"/>
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <TextBlock Classes="FieldLabel" Text="Port:"/>
                            <ComboBox ItemsSource="{Binding ControllerPorts}"
                                      SelectedIndex="{Binding SelectedPortIndex}"
                                      MinWidth="180"/>
                        </StackPanel>
                        <CheckBox Content="Plugged In"
                                  IsChecked="{Binding IsPluggedIn}"/>
                    </StackPanel>
                </Border>

                <!-- â”€â”€ Device info â”€â”€ -->
                <Border Classes="Section">
                    <StackPanel Spacing="8">
                        <TextBlock Classes="SectionTitle" Text="Device"/>
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <TextBlock Classes="FieldLabel" Text="Device Name:"/>
                            <TextBox Text="{Binding DeviceName}" MinWidth="260" MaxWidth="400"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <TextBlock Classes="FieldLabel" Text="Device Index:"/>
                            <NumericUpDown Value="{Binding DeviceIndex}"
                                           Minimum="-1" Maximum="16"
                                           FormatString="0" MinWidth="100"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- â”€â”€ Preset selector â”€â”€ -->
                <Border Classes="Section">
                    <StackPanel Spacing="8">
                        <TextBlock Classes="SectionTitle" Text="Presets"/>
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <ComboBox ItemsSource="{Binding Presets}"
                                      SelectedItem="{Binding SelectedPreset}"
                                      MinWidth="280">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}" Foreground="Black"/>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                            <Button Classes="ActionButton"
                                    Content="Apply Preset"
                                    Command="{Binding ApplyPresetCommand}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- â”€â”€ Button / Axis bindings â”€â”€ -->
                <Border Classes="Section">
                    <StackPanel Spacing="6">
                        <TextBlock Classes="SectionTitle" Text="Button &amp; Axis Mappings"/>
                        <TextBlock Text="Edit the SDL input string for each N64 input (e.g. button(0), axis(2+), hat(0 Right))."
                                   FontSize="12" Foreground="DimGray" Margin="0,0,0,4" TextWrapping="Wrap"/>

                        <ItemsControl ItemsSource="{Binding Bindings}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="vm:ControllerBinding">
                                    <Grid ColumnDefinitions="140,*,Auto" Margin="0,2">
                                        <TextBlock Grid.Column="0"
                                                   Classes="BindingLabel"
                                                   Text="{Binding DisplayLabel}"/>
                                        <TextBox Grid.Column="1"
                                                 Text="{Binding BoundValue}"
                                                 MinWidth="200"
                                                 Watermark="(unbound)"/>
                                        <Button Grid.Column="2"
                                                Classes="ClearButton"
                                                Content="âœ•"
                                                Command="{Binding $parent[ItemsControl].((vm:ControllerSetupViewModel)DataContext).ClearBindingCommand}"
                                                CommandParameter="{Binding}"/>
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- â”€â”€ Analog settings â”€â”€ -->
                <Border Classes="Section">
                    <StackPanel Spacing="8">
                        <TextBlock Classes="SectionTitle" Text="Analog Stick Settings"/>

                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <TextBlock Classes="FieldLabel" Text="Deadzone:"/>
                            <Slider Value="{Binding AnalogDeadzone}"
                                    Minimum="0" Maximum="16384"
                                    MinWidth="280" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding AnalogDeadzone}"
                                       Foreground="Black" VerticalAlignment="Center"
                                       MinWidth="50"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <TextBlock Classes="FieldLabel" Text="Peak:"/>
                            <Slider Value="{Binding AnalogPeak}"
                                    Minimum="1" Maximum="32768"
                                    MinWidth="280" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding AnalogPeak}"
                                       Foreground="Black" VerticalAlignment="Center"
                                       MinWidth="50"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- â”€â”€ Expansion pak â”€â”€ -->
                <Border Classes="Section">
                    <StackPanel Spacing="8">
                        <TextBlock Classes="SectionTitle" Text="Expansion Pak"/>
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <TextBlock Classes="FieldLabel" Text="Type:"/>
                            <ComboBox ItemsSource="{Binding ExpansionPakOptions}"
                                      SelectedIndex="{Binding SelectedExpansionPakIndex}"
                                      MinWidth="180"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>

        <!-- â•â•â• Bottom bar: actions + status â•â•â• -->
        <StackPanel Grid.Row="2" Spacing="6" Margin="20,8">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="8">
                <Button Classes="SaveButton"
                        Content="ðŸ’¾ Save"
                        Command="{Binding SaveBindingsCommand}"/>
                <Button Classes="ActionButton"
                        Content="Reset Defaults"
                        Command="{Binding ResetToDefaultsCommand}"/>
                <Button Classes="ActionButton"
                        Content="Reload from Disk"
                        Command="{Binding ReloadBindingsCommand}"/>
            </StackPanel>

            <TextBlock Text="{Binding StatusMessage}"
                       FontSize="13" Foreground="LightGray"
                       HorizontalAlignment="Center"
                       Margin="0,2"/>
        </StackPanel>
    </Grid>
</UserControl>
